<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>js_iso: avatar and a* pathfinding</title>
	<script src="../lib/jquery/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../lib/grid.js" type="text/javascript" charset="utf-8"></script>
	<script src="../lib/node.js" type="text/javascript" charset="utf-8"></script>
	<script src="../lib/a_star.js" type="text/javascript" charset="utf-8"></script>
	<script src="../lib/avatar.js" type="text/javascript" charset="utf-8"></script>
	<script src="../lib/iso.js" type="text/javascript" charset="utf-8"></script>
	
	<link rel="stylesheet" href="grid.css" type="text/css" media="screen" charset="utf-8">
	
	
	<script type="text/javascript" charset="utf-8">
		var grid, iso;
		
		$(document).ready(function(){
			iso = new Iso(6,6,'#board');
			grid = iso.grid;
			iso.render();
			
			function follow_path() {
				if (iso.avatar.movement_queue.length == 0) {
					return true;
				}
				
				iso.avatar.step();
				node = iso.avatar.node();
				$('#avatar').animate({
					top: '-=10'
				}, 50)
				.animate({
					left: node.left() + iso.avatar_offset[0],
					top: node.top() + iso.avatar_offset[1]
				}, 200, function() {
					
					if (iso.avatar.movement_queue.length == 0) {
						$('#tile_' + node.index()).css("background", "url('images/tile.png') no-repeat top left");
						return true;
					} else {
						follow_path();
					}
				});
			}
			
			$('#board div span').mouseenter(function() {
				$(this).css("background", "url('images/target.png') no-repeat center");
			});
			
			$('#board div span').mouseleave(function() {
				$(this).css("background", "none");
			});
			
			$('#board div span').click(function(e) {
				var tile = $(this).parent();
				tile.css("background", "url('images/highlight.png') no-repeat top left");
				var start_x = iso.avatar.position[0];
				var start_y = iso.avatar.position[1];
				var end_x = $(this).parent().data("xy")[0];
				var end_y = $(this).parent().data("xy")[1];
				
				iso.avatar.determine_path(start_x, start_y, end_x, end_y);
				if (iso.avatar.movement_queue.length > 0) {
					follow_path();
				}
			});
			
		});
		
		
	</script>
	
</head>

<body>
	<h3>A 6x6 grid with a bounding box</h3>
	<p>Click on a square.</p>
	<div id="board"></div>
</body>
</html>
